# 차익거래 전략

ArBot이 지원하는 차익거래 전략의 원리, 파라미터, 리스크를 설명합니다.

## Spatial Arbitrage (거래소 간 가격차)

동일 자산이 서로 다른 거래소에서 다른 가격에 거래되는 현상을 이용하는 가장 기본적인 차익거래 전략입니다.

### 원리

1. 거래소 A에서 낮은 가격에 매수
2. 거래소 B에서 높은 가격에 매도
3. 가격 차이에서 수수료를 차감한 순이익 확보

### 전제조건

- **Pre-funded Model**: 양쪽 거래소에 사전 자금 배치 필요 (송금 지연 제거)
- 양 거래소에서 동일 자산의 충분한 유동성 확보

### 핵심 파라미터

| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `min_spread_pct` | 0.25% | 최소 스프레드 (왕복 수수료 0.20~0.25% 이상) |
| `min_depth_usd` | $1,000 | 해당 가격대의 최소 유동성 |
| `max_latency_ms` | 500ms | 최대 허용 레이턴시 |

### 예시 시나리오

```
BTC/USDT 가격:
  Binance: $64,000 (매수)
  OKX:     $64,200 (매도)

총 스프레드:     0.31%
수수료 (왕복):  -0.20% (Binance 0.10% + OKX 0.10%)
순 스프레드:     0.11%

거래 금액: $10,000
예상 순이익: $11.00
```

### 리스크

- **실행 지연**: 양 거래소 동시 주문 사이의 시간차로 가격 변동 발생
- **슬리피지**: 실제 체결가가 예상 가격과 다를 수 있음
- **오더북 깊이 부족**: 원하는 수량을 한 가격대에서 체결하지 못할 수 있음

## Triangular Arbitrage (삼각 차익)

단일 거래소 내에서 3개 거래쌍 간의 가격 불일치를 활용하는 전략입니다.

### 원리

3개의 거래쌍을 순환 거래하여 시작 자산보다 많은 양을 확보합니다.

```
경로 예시:
USDT → BTC/USDT → ETH/BTC → ETH/USDT → USDT

1. USDT로 BTC 매수 (BTC/USDT)
2. BTC로 ETH 매수 (ETH/BTC)
3. ETH를 USDT로 매도 (ETH/USDT)
4. 최종 USDT가 시작 USDT보다 많으면 이익
```

### 핵심 파라미터

| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `min_profit_pct` | 0.15% | 최소 이익률 (3회 수수료 차감 후) |
| `paths` | BTC/ETH 조합 | 탐색할 삼각 경로 목록 |

### 지원 경로

```yaml
paths:
  - [BTC/USDT, ETH/BTC, ETH/USDT]
```

### 장점

- 자금 이동 불필요 (단일 거래소 내 거래)
- 송금 지연/수수료 없음
- 거래소 카운터파티 리스크 최소화

### 리스크

- **낮은 마진**: 3회 거래 수수료 합산으로 순이익 압박
- **봇 경쟁 치열**: 밀리초 단위 경쟁으로 기회가 빠르게 소멸
- **부분 체결**: 3단계 중 일부만 체결 시 포지션 불균형

## Statistical Arbitrage (통계적 차익)

공적분(Cointegration) 관계에 있는 자산 쌍의 스프레드가 평균으로 회귀하는 성질을 활용하는 중빈도 전략입니다.

### 원리

1. **공적분 페어 탐색**: Engle-Granger 또는 Johansen 테스트로 장기 균형 관계를 가진 자산 쌍 발견
2. **스프레드 계산**: 두 자산 가격의 선형 결합으로 스프레드 시계열 구성
3. **Z-Score 시그널**: 스프레드가 평균에서 크게 벗어나면 진입, 평균 복귀 시 청산

### Z-Score 기반 매매 시그널

```
Z-Score > +2.0 (entry_threshold)  → 스프레드 과대: Short Spread
                                     (비싼 자산 매도, 싼 자산 매수)

Z-Score < -2.0                    → 스프레드 과소: Long Spread
                                     (비싼 자산 매수, 싼 자산 매도)

|Z-Score| < 0.5 (exit_threshold)  → 평균 회귀: 포지션 청산
```

### 핵심 파라미터

| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `lookback_periods` | 60 | Z-Score 계산 룩백 기간 |
| `entry_zscore` | 2.0 | 진입 Z-Score 임계값 |
| `exit_zscore` | 0.5 | 청산 Z-Score 임계값 |
| `p_value_threshold` | 0.05 | 공적분 검정 p-value 기준 |

### 장점

- 자금 이동 불필요 (동일 거래소 내 롱/숏 포지션)
- 시장 방향성에 비의존적 (Market Neutral)
- 중빈도 전략으로 경쟁 압력이 상대적으로 낮음

### 리스크

- **모델 리스크**: 공적분 관계가 영구적이지 않음 (구조적 변화 가능)
- **관계 붕괴**: 시장 레짐 전환 시 스프레드가 평균으로 회귀하지 않을 수 있음
- **과적합**: 백테스팅에서 좋은 성과가 실전에서 재현되지 않을 수 있음

## Funding Rate Arbitrage (펀딩비 차익)

무기한 선물(Perpetual Futures)의 펀딩비율(Funding Rate) 양/음 차이를 활용하는 전략입니다.

### 원리

1. 펀딩비가 양수인 거래소에서 숏 포지션 (펀딩비 수취)
2. 현물 또는 다른 거래소에서 롱 포지션 (헤지)
3. 8시간마다 지급되는 펀딩비 차이로 수익 확보

### 예시 시나리오

```
BTC 무기한 선물 펀딩비:
  Binance: +0.03% (8시간마다 숏이 수취)
  Bybit:   -0.01% (8시간마다 롱이 수취)

전략:
  Binance에서 숏 → 펀딩비 +0.03% 수취
  Bybit에서 롱   → 펀딩비 +0.01% 수취
  순 펀딩비 수익: 0.04% / 8시간

일일 수익: 0.04% x 3 = 0.12% (자본 대비)
```

### 장점

- 상대적으로 안정적이고 예측 가능한 수익
- 가격 방향성 리스크 헤지 (롱/숏 동시 보유)
- 8시간마다 정기적 수익 발생

### 리스크

- **포지션 유지 리스크**: 펀딩비 방향이 급변할 수 있음
- **마진콜**: 급격한 가격 변동 시 한쪽 포지션에서 마진 부족 발생
- **자금 효율**: 양쪽 거래소에 마진을 예치해야 하므로 자본 효율이 낮음

## 전략 비교

| 전략 | 리스크 | 기대 수익률 | 빈도 | 복잡도 | 자금 이동 |
|------|--------|-----------|------|--------|----------|
| **Spatial** | 중간 | 0.1~0.5%/건 | 높음 | 낮음 | 불필요 (Pre-funded) |
| **Triangular** | 낮음 | 0.05~0.2%/건 | 매우 높음 | 중간 | 불필요 |
| **Statistical** | 중간 | 0.5~2.0%/건 | 중간 | 높음 | 불필요 |
| **Funding Rate** | 낮음 | 0.01~0.1%/8h | 고정 (8h) | 중간 | 불필요 (Pre-funded) |

::: tip 전략 조합
ArBot은 여러 전략을 동시에 운용할 수 있습니다. Spatial과 Triangular를 고빈도로 실행하면서, Statistical과 Funding Rate를 중/저빈도로 병행하는 것이 일반적인 구성입니다.
:::
