# PRD: ArBot - 암호화폐 크로스 거래소 차익거래 시스템

> **Version**: 1.0
> **Date**: 2026-02-08
> **Status**: Draft

---

## 1. 개요 (Executive Summary)

ArBot은 전 세계 주요 암호화폐 거래소 간의 가격 차이를 실시간으로 감지하고, 특정 거래소를 통한 자동 매매로 차익을 실현하는 자동화 트레이딩 시스템이다.

**핵심 접근방식**: 시뮬레이션/백테스팅 → 페이퍼 트레이딩 → 실전 트레이딩의 단계적 전환을 통해 리스크를 최소화하며 수익화 알고리즘을 검증한다.

---

## 2. 문제 정의 (Problem Statement)

### 2.1 시장 기회
- 전 세계 600+ 거래소에서 동일 암호화폐가 거래되며, 거래소별 유동성/수요 차이로 가격 불일치 발생
- 한국 거래소(업비트, 빗썸)와 글로벌 거래소 간 김치 프리미엄/디스카운트 존재 (-0.18% ~ +30% 역사적 범위)
- 변동성 높은 시장 상황에서 MEV 기회 300% 증가 관측

### 2.2 현실적 도전
- 차익거래 마진이 점점 축소 (0.1~0.5% 수준)
- 거래 수수료 왕복 0.20~0.25%로 순이익 압박
- 밀리초 단위 경쟁 (47ms 지연 시 연간 약 $180,000 기회비용 발생)
- 출금/입금 확인 지연 (BTC ~30분, ETH ~5분, SOL ~1분)

---

## 3. 목표 (Goals)

### 3.1 Phase 1 - 시뮬레이션 & 백테스팅 (MVP)
- [ ] 10+ 거래소 실시간 가격 수집 인프라 구축
- [ ] 차익거래 기회 탐지 엔진 개발
- [ ] 히스토리컬 데이터 기반 백테스팅 프레임워크 구축
- [ ] 실시간 시뮬레이터(페이퍼 트레이딩) 구현
- [ ] 수익성 분석 대시보드 개발

### 3.2 Phase 2 - 알고리즘 최적화
- [ ] 다중 전략 검증 (Spatial, Triangular, Statistical Arbitrage)
- [ ] 수수료/슬리피지/지연시간을 반영한 실제 수익률 시뮬레이션
- [ ] 자동 리밸런싱 전략 최적화
- [ ] 리스크 관리 모듈 고도화

### 3.3 Phase 3 - 실전 트레이딩
- [ ] 소규모 자금 실전 투입 (전체 자본의 5~10%)
- [ ] 특정 거래소 중심 자동 매매 실행
- [ ] 24/7 모니터링 및 알림 시스템
- [ ] 점진적 자금 규모 확대

---

## 4. 타겟 거래소 (Target Exchanges)

### 4.1 Tier 1 - 핵심 거래소 (자본 40~50%)
| 거래소 | 특징 | Maker/Taker 수수료 | WebSocket |
|--------|------|-------------------|-----------|
| **Binance** | 최대 유동성, sub-100ms 실행 | 0.10% / 0.10% | 200 스트림/연결, 100ms 갱신 |
| **OKX** | 경쟁력 있는 수수료, 마이너스 메이커 리베이트 | 0.08% / 0.10% | Per-connection |
| **Bybit** | 빠른 출금 처리, sub-100ms 실행 | 0.10% / 0.10% | REST와 독립적 제한 |

### 4.2 Tier 2 - 보조 거래소 (자본 30~40%)
| 거래소 | 특징 | Maker/Taker 수수료 | WebSocket |
|--------|------|-------------------|-----------|
| **KuCoin** | 알트코인 커버리지 | 0.10% / 0.10% | 800 연결/유저 |
| **Gate.io** | 1,700+ 코인, 니치 페어 | 0.20% / 0.20% | Auto-reconnect |
| **Bitget** | 성장 중, 카피트레이딩 | 0.10% / 0.10% | Reconnect 권장 |

### 4.3 한국 거래소 (KRW 마켓 접근 시)
| 거래소 | 특징 | Maker/Taker 수수료 |
|--------|------|-------------------|
| **Upbit** | 최대 한국 거래소, 150+ KRW 페어 | 0.05% / 0.05% (KRW) |
| **Bithumb** | 깊은 KRW 유동성 | 0.04% / 0.04% (KRW) |

> **참고**: 한국 거래소는 한국 은행 계좌 + 실명 인증 필수. 외국인 투자자 KRW 직접 거래 불가.

---

## 5. 차익거래 전략 (Arbitrage Strategies)

### 5.1 Strategy A: Spatial Arbitrage (거래소 간 가격차 차익)
- **원리**: 거래소 A에서 낮은 가격에 매수 → 거래소 B에서 높은 가격에 매도
- **전제조건**: 양 거래소에 사전 자금 배치 (Pre-funded Model)
- **최소 스프레드**: 왕복 수수료 0.20~0.25% 이상
- **리스크**: 실행 지연, 슬리피지, 오더북 깊이 부족

### 5.2 Strategy B: Triangular Arbitrage (삼각 차익)
- **원리**: 단일 거래소 내 3개 페어 간 가격 불일치 활용
- **예시**: BTC/USDT → ETH/BTC → ETH/USDT → USDT
- **장점**: 자금 이동 불필요, 단일 거래소 리스크
- **리스크**: 낮은 마진, 봇 경쟁 치열

### 5.3 Strategy C: Statistical Arbitrage (통계적 차익)
- **원리**: 공적분(Cointegration) 관계에 있는 자산 쌍의 스프레드가 평균으로 회귀하는 성질 활용
- **도구**: Engle-Granger 테스트, Johansen 공적분 테스트, Z-Score
- **장점**: 자금 이동 불필요, 중빈도 전략 가능
- **리스크**: 모델 리스크, 관계 붕괴 가능

### 5.4 Strategy D: Funding Rate Arbitrage (펀딩비 차익)
- **원리**: 무기한 선물의 펀딩비율 양/음 차이를 활용
- **장점**: 상대적으로 안정적 수익
- **리스크**: 포지션 유지 리스크, 마진콜

---

## 6. 핵심 기능 요구사항 (Functional Requirements)

### FR-01: 실시간 가격 수집 엔진
- 10+ 거래소 WebSocket 동시 연결
- 오더북 Depth (최소 5~20 레벨) 실시간 수신
- 틱 데이터 수집 및 저장 (Level-2)
- 레이턴시 측정 및 기록

### FR-02: 차익거래 기회 탐지 엔진
- 거래소 간 실시간 스프레드 계산
- 수수료/슬리피지 반영 순이익 계산
- 최소 수익 임계값(Threshold) 설정
- 삼각 차익 경로 탐색
- 통계적 차익 시그널 생성 (Z-Score)

### FR-03: 백테스팅 프레임워크
- 히스토리컬 틱 데이터 로딩
- 거래 수수료, 슬리피지, 레이턴시 시뮬레이션
- 주문 체결 시뮬레이션 (오더북 깊이 반영)
- 성과 지표: Sharpe Ratio, Max Drawdown, Win Rate, PnL
- 워크-포워드 분석 (Walk-Forward Analysis)

### FR-04: 실시간 시뮬레이터 (Paper Trading)
- 실시간 가격 데이터 기반 가상 매매
- 실제 오더북에 기반한 체결 시뮬레이션
- 가상 포트폴리오 잔고 관리
- 실시간 PnL 추적

### FR-05: 주문 실행 엔진 (Phase 3)
- 거래소 API를 통한 실제 주문 (Limit, IOC)
- 동시 양방향 주문 (매수/매도 동시 실행)
- 주문 상태 추적 및 실패 처리
- 부분 체결 처리

### FR-06: 리밸런싱 엔진
- 거래소 간 잔고 모니터링
- 자동 리밸런싱 알림/실행
- 최적 전송 네트워크 선택 (수수료/속도)
- 출금/입금 상태 추적

### FR-07: 리스크 관리 모듈
- 포지션 크기 제한 (거래소별, 코인별)
- 일일 최대 손실 제한 (Stop-Loss)
- 거래소 다운타임 감지 및 대응
- 이상 가격 감지 (Flash Crash 방어)
- 자본 집중도 관리 (Tier별 한도)

### FR-08: 모니터링 대시보드
- 실시간 거래소별 가격 비교 차트
- 차익거래 기회 히트맵
- PnL 추적 대시보드
- 시스템 상태 모니터링 (레이턴시, 연결 상태)
- 알림 시스템 (Telegram/Slack/Email)

---

## 7. 비기능 요구사항 (Non-Functional Requirements)

### NFR-01: 성능
- 가격 데이터 수신 → 기회 탐지: < 10ms
- 주문 생성 → API 전송: < 5ms
- 10+ 거래소 WebSocket 동시 안정 연결
- 백테스팅 1년치 틱 데이터 처리: < 30분

### NFR-02: 안정성
- 시스템 가용성: 99.9% (24/7 운영)
- 자동 재연결 (WebSocket 끊김 대응)
- 그레이스풀 셧다운 (미체결 주문 정리)
- 데이터 유실 방지 (WAL/저널링)

### NFR-03: 보안
- API 키 암호화 저장 (AES-256)
- IP 화이트리스트 (거래소 API 보안)
- 출금 기능 API 키 권한 분리
- 감사 로그 (모든 거래 기록)

### NFR-04: 확장성
- 새 거래소 추가: 커넥터 플러그인 아키텍처
- 새 전략 추가: 전략 인터페이스 표준화
- 수평 확장: 코인 페어별 독립 프로세스

---

## 8. 사용자 시나리오 (User Scenarios)

### Scenario 1: 백테스팅 실행
```
1. 사용자가 전략 파라미터 설정 (거래소 조합, 코인 페어, 기간, 임계값)
2. 히스토리컬 데이터 로딩 및 전처리
3. 백테스팅 엔진이 전략 시뮬레이션 실행
4. 성과 리포트 생성 (PnL 곡선, Sharpe Ratio, Drawdown 등)
5. 사용자가 파라미터 조정 후 재실행
```

### Scenario 2: 실시간 시뮬레이션 (Paper Trading)
```
1. 시스템이 10+ 거래소 WebSocket 연결
2. 실시간 가격 데이터 수집 및 기회 탐지
3. 기회 발견 시 가상 매매 실행
4. 실시간 대시보드에서 PnL 추적
5. 일일 리포트 자동 생성
```

### Scenario 3: 실전 트레이딩 (Phase 3)
```
1. 사전 조건 충족 확인 (시뮬레이션 수익률, 리스크 지표)
2. 소규모 자금으로 실전 투입
3. 차익 기회 탐지 → 양 거래소 동시 주문 실행
4. 체결 확인 및 PnL 기록
5. 주기적 리밸런싱 실행
6. 24/7 모니터링 + 이상 감지 시 알림/자동 정지
```

---

## 9. 성공 지표 (Success Metrics)

| 지표 | Phase 1 목표 | Phase 2 목표 | Phase 3 목표 |
|------|------------|------------|------------|
| 거래소 연결 수 | 5+ | 10+ | 10+ |
| 기회 탐지 레이턴시 | < 100ms | < 50ms | < 10ms |
| 백테스팅 Sharpe Ratio | > 1.0 | > 1.5 | 실전 유지 |
| 일일 기회 탐지 수 | 측정만 | 100+ | 실행 50+ |
| 시뮬레이션 일일 수익률 | 측정만 | > 0.05% | 실전 검증 |
| 시스템 가용성 | 95% | 99% | 99.9% |
| 최대 드로다운 | - | < 2% | < 1% |

---

## 10. 제약사항 및 리스크 (Constraints & Risks)

### 10.1 기술적 리스크
- **거래소 API 변경/제한**: Rate limit 강화, API 버전 변경
- **네트워크 지연**: 지리적 위치에 따른 레이턴시 차이
- **데이터 품질**: 거래소별 시간 동기화, 틱 데이터 누락

### 10.2 시장 리스크
- **마진 축소**: 시장 효율화에 따른 차익 기회 감소
- **극단적 변동성**: Flash Crash 시 급격한 손실
- **유동성 리스크**: 오더북 깊이 부족으로 슬리피지 발생

### 10.3 규제 리스크
- **한국**: VAPUA법(2024), Travel Rule, CARF(2026) 준수
- **글로벌**: 국가별 암호화폐 거래 규제 변화
- **세금**: 차익거래 수익에 대한 과세 의무

### 10.4 운영 리스크
- **거래소 해킹/파산**: 자금 분산 배치로 완화
- **자금 동결**: KYC/AML 위반 시 계정 동결
- **API 키 유출**: 보안 관리 필수

---

## 11. 용어 정의 (Glossary)

| 용어 | 정의 |
|------|------|
| **Spatial Arbitrage** | 동일 자산의 거래소 간 가격 차이를 이용한 차익거래 |
| **Triangular Arbitrage** | 단일 거래소 내 3개 거래쌍의 가격 불일치를 이용한 차익거래 |
| **Statistical Arbitrage** | 통계적 모델(공적분 등)을 활용한 상대가치 차익거래 |
| **Pre-funded Model** | 복수 거래소에 사전 자금을 배치하여 송금 지연 제거 |
| **Kimchi Premium** | 한국 거래소와 글로벌 거래소 간 가격 프리미엄 |
| **Slippage** | 예상 체결가와 실제 체결가의 차이 |
| **IOC (Immediate-or-Cancel)** | 즉시 체결되지 않은 잔량은 취소하는 주문 유형 |
| **Z-Score** | 스프레드가 평균에서 얼마나 벗어났는지를 나타내는 표준화 지표 |
| **Cointegration** | 두 시계열이 장기적으로 균형 관계를 유지하는 통계적 성질 |
| **Walk-Forward Analysis** | 과적합을 방지하기 위해 시간 순서대로 학습/검증을 반복하는 백테스팅 방법 |
